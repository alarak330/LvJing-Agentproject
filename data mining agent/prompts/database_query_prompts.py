"""
数据库查询模块提示词模板。

用于根据数据分析智能体提供的需求 JSON，生成数据库查询策略，
包括需要查询的法条和类案信息。
"""

from __future__ import annotations

from .base import create_prompt_template


# 数据库查询策略生成提示词
DATABASE_QUERY_STRATEGY_PROMPT = create_prompt_template(
    name="database_query_strategy",
    system_role="""你是一个专业的法律数据库查询策略生成助手，擅长根据数据分析智能体提供的需求信息，生成精确的数据库查询策略。

你的任务是：
1. 分析需求 JSON 中的法条引用信息，生成需要查询的法条列表
2. 根据案件类型、争议焦点、关键事实等信息，生成类案查询条件
3. 确保查询策略的准确性和完整性
4. 严格按照指定的 JSON 格式输出查询策略

请只输出 JSON 格式的结果，不要包含任何额外的文本、说明或代码块标记。""",
    template="""请根据以下数据分析智能体提供的需求 JSON，生成数据库查询策略：

需求 JSON：
{requirement_json}

请按照以下 JSON 格式输出查询策略：
{{
    "laws": [
        {{
            "table": "法律名称（如：刑法、民法典、劳动法等）",
            "id": "条号（如：第一条、第二百三十四条等）",
            "content": "法条内容关键词或查询条件（可选，用于模糊匹配）"
        }}
    ],
    "cases": [
        {{
            "table": "案件类型（刑事|民事|行政|赔偿|执行案件）",
            "content": "类案查询条件描述，包括：案件类型、争议焦点、关键事实、地区、时间范围等查询条件"
        }}
    ]
}}

注意事项：
1. 法条的 table 字段应该是具体的法律名称（如"刑法"、"民法典"、"劳动合同法"等）
2. 法条的 id 字段应该是具体的条号（如"第一条"、"第二百三十四条"等）
3. 类案的 table 字段必须是以下之一：刑事、民事、行政、赔偿、执行案件
4. 类案的 content 字段应该包含详细的查询条件，用于后续的数据库查询
5. 如果需求 JSON 中没有明确提到法条，但根据案件类型和争议焦点可以推断出相关法条，也应该包含在查询策略中
6. 如果某个字段无法从需求中提取，请使用空列表 []

请只输出 JSON 格式的结果，不要包含任何额外的文本、说明或代码块标记。""",
    examples=[
        (
            """请根据以下数据分析智能体提供的需求 JSON，生成数据库查询策略：

需求 JSON：
{{
    "case_type": "民事",
    "case_subtype": "劳动争议",
    "parties": {{
        "plaintiff": {{
            "name": "张三",
            "type": "个人",
            "region": "北京"
        }},
        "defendant": {{
            "name": "北京XX科技有限公司",
            "type": "企业",
            "region": "北京"
        }}
    }},
    "dispute_focus": "违法解除劳动合同的赔偿问题",
    "claims": [
        "支付拖欠工资50000元",
        "支付违法解除劳动合同赔偿金10000元"
    ],
    "key_facts": [
        "2020年1月入职",
        "2023年3月被违法解除劳动合同",
        "拖欠工资50000元"
    ],
    "law_references": [
        {{
            "law": "劳动合同法",
            "article": "第四十七条"
        }},
        {{
            "law": "劳动合同法",
            "article": "第八十七条"
        }}
    ],
    "region": "北京",
    "time_info": {{
        "mentioned_dates": ["2020-01", "2023-03"],
        "time_range": {{
            "start": "2020-01",
            "end": "2023-03"
        }}
    }},
    "analysis_requirements": {{
        "primary_goal": "类案检索",
        "secondary_goals": ["胜诉率分析", "赔偿金额参考"]
    }},
    "other_info": {{
        "amount_claimed": "60000",
        "case_complexity": "中等",
        "special_notes": "涉及违法解除劳动合同的赔偿问题"
    }}
}}

请按照以下 JSON 格式输出查询策略：
{{
    "laws": [
        {{
            "table": "法律名称（如：刑法、民法典、劳动法等）",
            "id": "条号（如：第一条、第二百三十四条等）",
            "content": "法条内容关键词或查询条件（可选，用于模糊匹配）"
        }}
    ],
    "cases": [
        {{
            "table": "案件类型（刑事|民事|行政|赔偿|执行案件）",
            "content": "类案查询条件描述，包括：案件类型、争议焦点、关键事实、地区、时间范围等查询条件"
        }}
    ]
}}

注意事项：
1. 法条的 table 字段应该是具体的法律名称（如"刑法"、"民法典"、"劳动合同法"等）
2. 法条的 id 字段应该是具体的条号（如"第一条"、"第二百三十四条"等）
3. 类案的 table 字段必须是以下之一：刑事、民事、行政、赔偿、执行案件
4. 类案的 content 字段应该包含详细的查询条件，用于后续的数据库查询
5. 如果需求 JSON 中没有明确提到法条，但根据案件类型和争议焦点可以推断出相关法条，也应该包含在查询策略中
6. 如果某个字段无法从需求中提取，请使用空列表 []

请只输出 JSON 格式的结果，不要包含任何额外的文本、说明或代码块标记。""",
            """{{
    "laws": [
        {{
            "table": "劳动合同法",
            "id": "第四十七条",
            "content": "经济补偿"
        }},
        {{
            "table": "劳动合同法",
            "id": "第八十七条",
            "content": "违法解除劳动合同赔偿"
        }},
        {{
            "table": "劳动法",
            "id": "第五十条",
            "content": "工资支付"
        }}
    ],
    "cases": [
        {{
            "table": "民事",
            "content": "案件类型：劳动争议；争议焦点：违法解除劳动合同赔偿、拖欠工资；关键事实：违法解除劳动合同、拖欠工资；地区：北京；时间范围：2020-01至2023-03；诉讼请求：支付拖欠工资、支付违法解除劳动合同赔偿金"
        }}
    ]
}}"""
        ),
        (
            """请根据以下数据分析智能体提供的需求 JSON，生成数据库查询策略：

需求 JSON：
{{
    "case_type": "民事",
    "case_subtype": "合同纠纷",
    "parties": {{
        "plaintiff": {{
            "name": "上海XX贸易有限公司",
            "type": "企业",
            "region": "上海"
        }},
        "defendant": {{
            "name": "深圳XX电子科技有限公司",
            "type": "企业",
            "region": "深圳"
        }}
    }},
    "dispute_focus": "买卖合同货款支付纠纷，被告未按约支付剩余货款",
    "claims": [
        "支付货款1200000元",
        "支付逾期付款利息"
    ],
    "key_facts": [
        "2022年5月签订《货物买卖合同》",
        "合同总金额150万元",
        "被告仅支付30万元",
        "剩余120万元货款未付"
    ],
    "law_references": [
        {{
            "law": "民法典",
            "article": "第五百七十七条"
        }},
        {{
            "law": "民法典",
            "article": "第五百七十九条"
        }}
    ],
    "region": "上海",
    "time_info": {{
        "mentioned_dates": ["2022-05"],
        "time_range": {{
            "start": "2022-05",
            "end": null
        }}
    }},
    "analysis_requirements": {{
        "primary_goal": "类案检索",
        "secondary_goals": ["胜诉率分析", "利息计算参考"]
    }},
    "other_info": {{
        "amount_claimed": "1200000",
        "case_complexity": "中等",
        "special_notes": "涉及买卖合同货款支付及逾期利息"
    }}
}}

请按照以下 JSON 格式输出查询策略：
{{
    "laws": [
        {{
            "table": "法律名称（如：刑法、民法典、劳动法等）",
            "id": "条号（如：第一条、第二百三十四条等）",
            "content": "法条内容关键词或查询条件（可选，用于模糊匹配）"
        }}
    ],
    "cases": [
        {{
            "table": "案件类型（刑事|民事|行政|赔偿|执行案件）",
            "content": "类案查询条件描述，包括：案件类型、争议焦点、关键事实、地区、时间范围等查询条件"
        }}
    ]
}}

注意事项：
1. 法条的 table 字段应该是具体的法律名称（如"刑法"、"民法典"、"劳动合同法"等）
2. 法条的 id 字段应该是具体的条号（如"第一条"、"第二百三十四条"等）
3. 类案的 table 字段必须是以下之一：刑事、民事、行政、赔偿、执行案件
4. 类案的 content 字段应该包含详细的查询条件，用于后续的数据库查询
5. 如果需求 JSON 中没有明确提到法条，但根据案件类型和争议焦点可以推断出相关法条，也应该包含在查询策略中
6. 如果某个字段无法从需求中提取，请使用空列表 []

请只输出 JSON 格式的结果，不要包含任何额外的文本、说明或代码块标记。""",
            """{{
    "laws": [
        {{
            "table": "民法典",
            "id": "第五百七十七条",
            "content": "违约责任"
        }},
        {{
            "table": "民法典",
            "id": "第五百七十九条",
            "content": "金钱债务履行"
        }},
        {{
            "table": "民法典",
            "id": "第五百七十八条",
            "content": "预期违约"
        }},
        {{
            "table": "民法典",
            "id": "第六百二十六条",
            "content": "买卖合同价款支付"
        }}
    ],
    "cases": [
        {{
            "table": "民事",
            "content": "案件类型：合同纠纷；案件子类型：买卖合同纠纷；争议焦点：货款支付、逾期付款利息；关键事实：买卖合同、货款未付、逾期付款；地区：上海、深圳；时间范围：2022-05起；诉讼请求：支付货款、支付逾期利息；金额范围：100万-200万"
        }}
    ]
}}"""
        ),
        (
            """请根据以下数据分析智能体提供的需求 JSON，生成数据库查询策略：

需求 JSON：
{{
    "case_type": "刑事",
    "case_subtype": "故意伤害罪",
    "parties": {{
        "plaintiff": {{
            "name": "被害人李某",
            "type": "个人",
            "region": "广东"
        }},
        "defendant": {{
            "name": "被告人王某",
            "type": "个人",
            "region": "广东"
        }}
    }},
    "dispute_focus": "故意伤害他人身体，致人轻伤",
    "claims": [
        "追究被告人刑事责任",
        "赔偿医疗费等损失"
    ],
    "key_facts": [
        "2023年6月发生冲突",
        "被告人持械伤害被害人",
        "造成被害人轻伤二级"
    ],
    "law_references": [
        {{
            "law": "刑法",
            "article": "第二百三十四条"
        }}
    ],
    "region": "广东",
    "time_info": {{
        "mentioned_dates": ["2023-06"],
        "time_range": {{
            "start": "2023-06",
            "end": null
        }}
    }},
    "analysis_requirements": {{
        "primary_goal": "类案检索",
        "secondary_goals": ["量刑参考", "赔偿标准"]
    }},
    "other_info": {{
        "case_complexity": "简单",
        "special_notes": "持械故意伤害，致人轻伤"
    }}
}}

请按照以下 JSON 格式输出查询策略：
{{
    "laws": [
        {{
            "table": "法律名称（如：刑法、民法典、劳动法等）",
            "id": "条号（如：第一条、第二百三十四条等）",
            "content": "法条内容关键词或查询条件（可选，用于模糊匹配）"
        }}
    ],
    "cases": [
        {{
            "table": "案件类型（刑事|民事|行政|赔偿|执行案件）",
            "content": "类案查询条件描述，包括：案件类型、争议焦点、关键事实、地区、时间范围等查询条件"
        }}
    ]
}}

注意事项：
1. 法条的 table 字段应该是具体的法律名称（如"刑法"、"民法典"、"劳动合同法"等）
2. 法条的 id 字段应该是具体的条号（如"第一条"、"第二百三十四条"等）
3. 类案的 table 字段必须是以下之一：刑事、民事、行政、赔偿、执行案件
4. 类案的 content 字段应该包含详细的查询条件，用于后续的数据库查询
5. 如果需求 JSON 中没有明确提到法条，但根据案件类型和争议焦点可以推断出相关法条，也应该包含在查询策略中
6. 如果某个字段无法从需求中提取，请使用空列表 []

请只输出 JSON 格式的结果，不要包含任何额外的文本、说明或代码块标记。""",
            """{{
    "laws": [
        {{
            "table": "刑法",
            "id": "第二百三十四条",
            "content": "故意伤害罪"
        }},
        {{
            "table": "刑法",
            "id": "第六十七条",
            "content": "自首"
        }},
        {{
            "table": "刑法",
            "id": "第七十二条",
            "content": "缓刑"
        }},
        {{
            "table": "民法典",
            "id": "第一千一百七十九条",
            "content": "人身损害赔偿"
        }}
    ],
    "cases": [
        {{
            "table": "刑事",
            "content": "案件类型：刑事案件；案件子类型：故意伤害罪；争议焦点：故意伤害他人身体、致人轻伤；关键事实：持械伤害、轻伤二级；地区：广东；时间范围：2023-06起；伤害程度：轻伤"
        }},
        {{
            "table": "赔偿",
            "content": "案件类型：人身损害赔偿；争议焦点：医疗费、误工费等损失赔偿；关键事实：故意伤害、轻伤二级；地区：广东；时间范围：2023-06起"
        }}
    ]
}}"""
        )
    ]
)

